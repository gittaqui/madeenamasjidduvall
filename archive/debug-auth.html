<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Auth Debug</title>
  <meta name="robots" content="noindex, nofollow" />
  <link rel="stylesheet" href="css/bootstrap.min.css" />
  <style>body{padding:1rem;font-family:system-ui,Arial,sans-serif;} pre{background:#f5f5f5;padding:1rem;border:1px solid #ddd;max-width:900px;overflow:auto;} code{font-size:12px;} .badge{font-size:0.75rem;} </style>
</head>
<body>
  <h1>Static Web Apps Auth Debug</h1>
  <p>This page shows what <code>/.auth/me</code> and <code>/api/me</code> return. Use it after attempting sign-in. If both are empty you are not authenticated (cookie missing).</p>
  <div id="status" class="mb-3 small text-secondary">Loadingâ€¦</div>
  <h2>/.auth/me</h2>
  <pre id="authMe">(loading)</pre>
  <h2>/api/me</h2>
  <pre id="apiMe">(loading)</pre>
  <script>
    async function grab(url, target){
      try{ const r = await fetch(url+ (url.includes('?')?'&':'?') + 'ts=' + Date.now(), {credentials:'include'}); const t = await r.text(); document.getElementById(target).textContent = t; return t; }catch(e){ document.getElementById(target).textContent='ERROR '+e; }
    }
    (async()=>{
      const a = await grab('/.auth/me','authMe');
      const b = await grab('/api/me','apiMe');
      const statusEl = document.getElementById('status');
      try{
        const parsed = JSON.parse(a||'{}');
        const principal = parsed.clientPrincipal || parsed.principal;
        if(principal){
          statusEl.textContent = 'Authenticated as: ' + (principal.userDetails || '(no userDetails)') + ' | Roles: ' + (principal.userRoles||[]).join(', ');
        } else {
          statusEl.textContent = 'Not authenticated (no principal in /.auth/me).';
        }
      }catch{ statusEl.textContent='Could not parse /.auth/me JSON'; }
    })();
  </script>
</body>
</html>